@page "/"
@using System.ComponentModel.DataAnnotations

<index-container>
    <div class="title">算法易</div>
    <EditForm class="form-group" EditContext="Context" OnValidSubmit="LoginSubmit">
        <DataAnnotationsValidator/>

        <p class="login-form-group">
            <InputText class="form-control login-form" placeholder="用户名" @bind-Value="Info.UserId"/>
            <ValidationMessage For="() => Info.UserId"/>
        </p>
        <p class="login-form-group">
            <InputText class="form-control login-form" type="password" placeholder="密码" @bind-Value="Info.Password"/>
            <ValidationMessage For="() => Info.Password"/>
        </p>
        <p class="login-form-group space-between">
            <span>
                <InputCheckbox @bind-Value="RememberPassword"></InputCheckbox>
                <span>记住密码</span>
            </span>
            <span>忘记密码？</span>
        </p>
        <div class="login-form-group">
            <button class="btn btn-primary login-form login-form-button blue-bg" type="submit">登 录</button>
        </div>
        <p class="text-end">
            还没有账户？<span class="text-primary">立即注册</span>
        </p>
    </EditForm>
</index-container>

@code
{
    [CascadingParameter]
    public MainLayout Layout { get; init; }

    LoginInfo Info { get; set; }

    EditContext Context { get; set; }

    bool RememberPassword { get; set; }

    protected override Task OnInitializedAsync()
    {
        Layout.Page = Page.Index;
        Info = new();
        Context = new(Info);
        return base.OnInitializedAsync();
    }

    void LoginSubmit()
    {
        if (string.IsNullOrEmpty(Info.UserId) || string.IsNullOrEmpty(Info.Password))
        {
            _toastService.ShowError("用户名或密码不得为空", "登录失败");
            return;
        }

        var password = (Info.UserId + Info.Password).GetSha256();
        _authenticationService.Login(Info.UserId, password);

        _navigation.NavigateTo("/project");
    }

    class LoginInfo
    {
        [Required(ErrorMessage = "请输入用户名")]
        public string UserId { get; set; }
        [Required(ErrorMessage = "请输入密码")]
        public string Password { get; set; }
    }
}

